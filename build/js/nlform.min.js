!function(t){"use strict";var e=t.document;function i(t){this.el=t,this.overlay=this.el.querySelector(".nl-overlay"),this.fields=[],this.fldOpen=-1,this._init()}function n(t,e,i,n){this.form=t,this.elOriginal=e,this.pos=n,this.type=i,this._create(),this._initEvents()}String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),i.prototype={_init:function(){var i=this;Array.prototype.slice.call(this.el.querySelectorAll("select")).forEach(function(t,e){i.fldOpen++,i.fields.push(new n(i,t,"dropdown",i.fldOpen))}),Array.prototype.slice.call(this.el.querySelectorAll("input")).forEach(function(t,e){i.fldOpen++,i.fields.push(new n(i,t,"input",i.fldOpen))}),this.overlay.addEventListener("click",function(t){i._closeFlds()}),this.overlay.addEventListener("touchstart",function(t){i._closeFlds()})},_closeFlds:function(){-1!==this.fldOpen&&this.fields[this.fldOpen].close()}},n.prototype={_create:function(){"dropdown"===this.type?this._createDropDown():"input"===this.type&&this._createInput()},_createDropDown:function(){var i=this;this.fld=e.createElement("div"),this.fld.className="nl-field nl-dd",this.toggle=e.createElement("a"),this.toggle.innerHTML=this.elOriginal.options[this.elOriginal.selectedIndex].innerHTML,this.toggle.className="nl-field-toggle",this.optionsList=e.createElement("ul");var n="";Array.prototype.slice.call(this.elOriginal.querySelectorAll("option")).forEach(function(t,e){n+=i.elOriginal.selectedIndex===e?'<li class="nl-dd-checked">'+t.innerHTML+"</li>":"<li>"+t.innerHTML+"</li>",i.elOriginal.selectedIndex===e&&(i.selectedIdx=e)}),this.optionsList.innerHTML=n,this.fld.appendChild(this.toggle),this.fld.appendChild(this.optionsList),this.elOriginal.parentNode.insertBefore(this.fld,this.elOriginal),this.elOriginal.style.display="none"},_createInput:function(){this.fld=e.createElement("div"),this.fld.className="nl-field nl-ti-text",this.toggle=e.createElement("a"),this.toggle.innerHTML=this.elOriginal.getAttribute("placeholder"),this.toggle.className="nl-field-toggle",this.optionsList=e.createElement("ul"),this.getinput=e.createElement("input"),this.getinput.setAttribute("type","text"),this.getinput.setAttribute("placeholder",this.elOriginal.getAttribute("placeholder")),this.getinputWrapper=e.createElement("li"),this.getinputWrapper.className="nl-ti-input",this.inputsubmit=e.createElement("button"),this.inputsubmit.className="nl-field-go",this.getinputWrapper.appendChild(this.getinput),this.getinputWrapper.appendChild(this.inputsubmit),this.example=e.createElement("li"),this.example.className="nl-ti-example",this.example.innerHTML=this.elOriginal.getAttribute("data-subline"),this.optionsList.appendChild(this.getinputWrapper),this.optionsList.appendChild(this.example),this.fld.appendChild(this.toggle),this.fld.appendChild(this.optionsList),this.elOriginal.parentNode.insertBefore(this.fld,this.elOriginal),this.elOriginal.style.display="none"},_initEvents:function(){var i=this;if(this.toggle.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),i._open()}),this.toggle.addEventListener("touchstart",function(t){t.preventDefault(),t.stopPropagation(),i._open()}),"dropdown"===this.type){var n=Array.prototype.slice.call(this.optionsList.querySelectorAll("li"));n.forEach(function(e,t){e.addEventListener("click",function(t){t.preventDefault(),i.close(e,n.indexOf(e))}),e.addEventListener("touchstart",function(t){t.preventDefault(),i.close(e,n.indexOf(e))})})}else"input"===this.type&&(this.getinput.addEventListener("keydown",function(t){13==t.keyCode&&i.close()}),this.inputsubmit.addEventListener("click",function(t){t.preventDefault(),i.close()}),this.inputsubmit.addEventListener("touchstart",function(t){t.preventDefault(),i.close()}))},_open:function(){if(this.open)return!1;this.open=!0,this.form.fldOpen=this.pos;this.fld.className+=" nl-field-open"},close:function(t,e){if(!this.open)return!1;(this.open=!1,this.form.fldOpen=-1,this.fld.className=this.fld.className.replace(/\b nl-field-open\b/,""),"dropdown"===this.type)?t&&(this.optionsList.children[this.selectedIdx].className="",t.className="nl-dd-checked",this.toggle.innerHTML=t.innerHTML,this.selectedIdx=e,this.elOriginal.value=this.elOriginal.children[this.selectedIdx].value):"input"===this.type&&(this.getinput.blur(),this.toggle.innerHTML=""!==this.getinput.value.trim()?this.getinput.value:this.getinput.getAttribute("placeholder"),this.elOriginal.value=this.getinput.value)}},t.NLForm=i}(window);